<!DOCTYPE html>
<html lang="zh-Hant" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>USPACE è¡Œå‹•å°èˆª (é•·æŒ‰è¤‡é¸åŠŸèƒ½)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ç¢ºä¿å…¨é«˜ï¼Œè®“åœ°åœ–èƒ½å¡«æ»¿è¦–å£ */
        html, body {
            height: 100%;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹•åœ°åœ–å’Œæ¸…å–®æ™‚ç”¢ç”Ÿé›™é‡æ»¾å‹•æ¢ */
        }
        /* æ¨¡æ“¬æ‰‹æ©Ÿç•«é¢çš„æœ€å¤§å¯¬åº¦ */
        #app-wrapper {
            max-width: 480px; 
            height: 100vh;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            background-color: #fff; 
        }
        .dark #app-wrapper {
             background-color: #1A1A1A;
        }
        /* è®“æ©«å‘æ»¾å‹•æ¢åœ¨æ”¯æ´çš„ç€è¦½å™¨ä¸Šéš±è— */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
   
    <script>
        // Tailwind Config with custom fonts and theme support
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'Inter', 'sans-serif'],
                        display: ['Inter', 'sans-serif'], 
                    },
                    colors: {
                        'uspace-primary': '#007AFF', // ç§‘æŠ€è—
                        'uspace-dark': '#1A1A1A',
                        'uspace-light': '#F4F7FB',
                        'success': '#10B981', 
                        'danger': '#EF4444', 
                        'uspace-yellow': '#FDE047', // è¨ˆè²»èªªæ˜æ©«å¹…
                        'uspace-tag': '#FCD34D',   // P1027 æ¨™ç±¤
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-100 dark:bg-uspace-dark font-sans">
    
    <div id="app-wrapper" class="bg-white dark:bg-uspace-dark text-uspace-dark dark:text-white transition-colors duration-300">

        <header class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-[inherit] z-20 p-4 bg-white dark:bg-uspace-dark shadow-md transition-colors duration-300">
            <div class="flex justify-between items-center">
                <button aria-label="è¿”å›" class="text-xl p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div class="flex-grow mx-3 relative">
                    <input type="text" placeholder="è¼¸å…¥ç›®çš„åœ°æˆ–åœ°å€..." class="w-full py-2 pl-10 pr-4 border border-gray-300 dark:border-gray-700 rounded-full focus:outline-none focus:ring-2 focus:ring-uspace-primary bg-uspace-light dark:bg-gray-800 transition-colors duration-300 placeholder:text-gray-500 dark:placeholder:text-gray-400 text-sm" aria-label="ç›®çš„åœ°æœå°‹">
                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
        </header>

        <main id="map-container" class="absolute inset-0 z-0 pt-[72px] pb-16">
            <img src="https://picsum.photos/480/800/?random=map" alt="åœ°åœ–æ¨¡æ“¬åœ–" class="w-full h-full object-cover grayscale dark:filter dark:brightness-50" aria-hidden="true">
        </main>
        
        <div class="absolute bottom-20 right-6 z-10">
            <button aria-label="å®šä½æˆ‘çš„ä½ç½®" class="w-12 h-12 bg-white dark:bg-gray-800 rounded-full shadow-xl text-xl text-uspace-primary hover:scale-105 transition-transform">
                <i class="fa-solid fa-location-crosshairs"></i>
            </button>
        </div>
        
        <section id="parking-list-drawer" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[inherit] z-30 max-h-[80vh] transition-transform duration-500 ease-in-out transform translate-y-0">
            
            <div class="bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl overflow-hidden flex flex-col h-full">
                
                <div id="drawer-header" class="p-3 pt-4 flex flex-col justify-center items-center cursor-grab active:cursor-grabbing flex-shrink-0">
                    <div class="w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full mb-2"></div>
                    <h2 class="text-lg font-bold">é™„è¿‘åœè»Šå ´</h2>
                </div>
                
                <div class="px-4 py-2 border-b border-gray-100 dark:border-gray-700 flex items-center space-x-3 overflow-x-auto whitespace-nowrap flex-shrink-0 no-scrollbar">
                    <button aria-label="é–‹å•Ÿç¯©é¸å™¨" class="flex items-center text-uspace-primary font-medium bg-uspace-light dark:bg-gray-700 px-3 py-1 rounded-full text-sm hover:opacity-80 transition-opacity flex-shrink-0">
                        <i class="fa-solid fa-sliders mr-2"></i>
                        ç¯©é¸
                    </button>
                    <span class="chip-active text-white bg-uspace-primary px-3 py-1 rounded-full text-sm flex-shrink-0 cursor-pointer">
                        <i class="fa-solid fa-road mr-1"></i> æœ€è¿‘è·é›¢
                    </span>
                    <span class="chip text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 flex-shrink-0">
                        <i class="fa-solid fa-dollar-sign mr-1"></i> æœ€ä½åƒ¹æ ¼
                    </span>
                    <span class="chip text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 flex-shrink-0">
                        <i class="fa-solid fa-clock-rotate-left mr-1"></i> 24H æœå‹™
                    </span>
                    <span class="chip text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 flex-shrink-0">
                        <i class="fa-solid fa-bookmark mr-1"></i> å¯é ç´„
                    </span>
                </div>

                
                <div id="parking-list-content" class="overflow-y-auto p-4 flex-grow space-y-4">

                    <article data-id="p102" class="parking-card relative p-4 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 transition-shadow hover:shadow-lg cursor-pointer">
                        <div class="selection-overlay hidden absolute inset-0 bg-uspace-primary/20 border-2 border-uspace-primary rounded-xl z-10 pointer-events-none"></div>
                        <div class="selection-badge hidden absolute top-2 left-2 w-6 h-6 bg-uspace-primary text-white rounded-full flex items-center justify-center font-bold text-sm border-2 border-white shadow-lg z-20 pointer-events-none">
                            </div>
                        
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="bg-uspace-tag text-black font-extrabold text-sm px-2 py-0.5 rounded">P102</span>
                                    <h3 class="font-bold text-lg" title="ä¿¡ç¾©å€æ¾è¸æ–‡å‰µåœè»Šå ´">ä¿¡ç¾©å€æ¾è¸æ–‡å‰µåœè»Šå ´</h3>
                                </div>
                                <div class="flex items-center space-x-3 text-sm text-gray-500 dark:text-gray-400">
                                    <p><span class="font-display font-semibold">0.3</span> km | é§•è»Š 2 åˆ†é˜</p>
                                    <p class="text-success font-semibold"><i class="fa-solid fa-car mr-1"></i>å‰©é¤˜ 12</p>
                                </div>
                            </div>
                            <div class="flex-shrink-0 ml-4 flex flex-col items-end">
                                <div class="mb-2 text-right">
                                    <span class="font-display font-extrabold text-xl text-uspace-dark dark:text-white">40</span>
                                    <span class="text-sm text-gray-600 dark:text-gray-400"> å…ƒ/å°æ™‚</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="bg-white border border-uspace-primary text-uspace-primary rounded-full px-4 py-1 text-sm font-semibold hover:bg-uspace-primary hover:text-white transition-colors">
                                        <i class="fa-solid fa-bookmark mr-1"></i> é ç´„
                                    </button>
                                    <button class="bg-uspace-primary text-white rounded-full px-4 py-1 text-sm font-semibold hover:opacity-90 transition-opacity">
                                        <i class="fa-solid fa-route mr-1"></i> å°èˆª
                                    </button>
                                </div>
                            </div>
                        </div>
                    </article>

                    <article data-id="p308" class="parking-card relative p-4 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 transition-shadow hover:shadow-lg cursor-pointer">
                        <div class="selection-overlay hidden absolute inset-0 bg-uspace-primary/20 border-2 border-uspace-primary rounded-xl z-10 pointer-events-none"></div>
                        <div class="selection-badge hidden absolute top-2 left-2 w-6 h-6 bg-uspace-primary text-white rounded-full flex items-center justify-center font-bold text-sm border-2 border-white shadow-lg z-20 pointer-events-none"></div>

                        <div class="flex justify-between items-start">
                             <div>
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="bg-uspace-tag text-black font-extrabold text-sm px-2 py-0.5 rounded">P308</span>
                                    <h3 class="font-bold text-lg" title="å…‰å¾©å—è·¯ç§äººè»Šä½">å…‰å¾©å—è·¯ç§äººè»Šä½</h3>
                                </div>
                                <div class="flex items-center space-x-3 text-sm text-gray-500 dark:text-gray-400">
                                    <p><span class="font-display font-semibold">0.8</span> km | é§•è»Š 3 åˆ†é˜</p>
                                    <p class="text-success font-semibold"><i class="fa-solid fa-car mr-1"></i>å‰©é¤˜ 3</p>
                                </div>
                            </div>
                            <div class="flex-shrink-0 ml-4 flex flex-col items-end">
                                <div class="mb-2 text-right">
                                    <span class="font-display font-extrabold text-xl text-uspace-dark dark:text-white">50</span>
                                    <span class="text-sm text-gray-600 dark:text-gray-400"> å…ƒ/å°æ™‚</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="bg-white border border-uspace-primary text-uspace-primary rounded-full px-4 py-1 text-sm font-semibold hover:bg-uspace-primary hover:text-white transition-colors">
                                        <i class="fa-solid fa-bookmark mr-1"></i> é ç´„
                                    </button>
                                    <button class="bg-uspace-primary text-white rounded-full px-4 py-1 text-sm font-semibold hover:opacity-90 transition-opacity">
                                        <i class="fa-solid fa-route mr-1"></i> å°èˆª
                                    </button>
                                </div>
                            </div>
                        </div>
                    </article>

                    <article data-id="p199" class="parking-card relative p-4 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900">
                        <div class="selection-overlay hidden absolute inset-0 bg-uspace-primary/20 border-2 border-uspace-primary rounded-xl z-10 pointer-events-none"></div>
                        <div class="selection-badge hidden absolute top-2 left-2 w-6 h-6 bg-uspace-primary text-white rounded-full flex items-center justify-center font-bold text-sm border-2 border-white shadow-lg z-20 pointer-events-none"></div>
                        
                        <div class="flex justify-between items-center opacity-50">
                             <div>
                                <div class="flex items-center space-x-2 mb-1">
                                    <span class="bg-gray-300 text-gray-700 font-extrabold text-sm px-2 py-0.5 rounded">P199</span>
                                    <h3 class="font-bold text-lg" title="å¸‚æ”¿åºœè½‰é‹ç«™">å¸‚æ”¿åºœè½‰é‹ç«™</h3>
                                </div>
                                <div class="flex items-center space-x-3 text-sm text-gray-500 dark:text-gray-400">
                                    <p><span class="font-display font-semibold">1.5</span> km</p>
                                </div>
                            </div>
                            <div class="text-right flex-shrink-0 ml-4">
                                <div class="flex flex-col items-center text-gray-500 dark:text-gray-400">
                                    <i class="fa-solid fa-car-on text-2xl mb-1 text-danger"></i>
                                    <span class="text-sm font-semibold">å·²æ»¿</span>
                                </div>
                            </div>
                        </div>
                    </article>

                    <div class="h-40 text-center text-gray-400 pt-8">[è¼‰å…¥æ›´å¤šåœè»Šå ´...]</div>
                </div>
            </div>
        </section>

        <div id="multi-select-cta-bar" class="fixed bottom-16 left-1/2 -translate-x-1/2 w-full max-w-[inherit] p-4 z-40 transform translate-y-full transition-transform duration-300 ease-in-out">
            <div class="bg-white dark:bg-gray-800 p-3 rounded-xl shadow-2xl flex items-center justify-between">
                <button id="cancel-multi-select-btn" class="text-gray-500 dark:text-gray-400 text-sm font-semibold p-2 hover:text-uspace-primary">
                    å–æ¶ˆ
                </button>
                <button id="start-navigation-btn" class="flex-grow bg-uspace-primary text-white font-bold py-2 px-4 rounded-full shadow-lg text-base hover:opacity-90 transition-opacity mx-3">
                    é–‹å§‹å°èˆª
                </button>
            </div>
        </div>

        <footer id="app-nav" class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[inherit] h-16 bg-white dark:bg-gray-800 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] dark:shadow-[0_-2px_10px_rgba(0,0,0,0.2)] z-40 transition-colors duration-300">
            <nav class="flex justify-around items-center h-full text-center">
                <a href="#" class="flex flex-col items-center text-gray-400 dark:text-gray-500 hover:text-uspace-primary dark:hover:text-uspace-primary transition-colors">
                    <i class="fa-solid fa-house text-xl"></i>
                    <span class="text-xs font-medium">é¦–é </span>
                </a>
                <a href="#" class="flex flex-col items-center text-uspace-primary dark:text-uspace-primary transition-colors">
                    <i class="fa-solid fa-map-location-dot text-xl"></i>
                    <span class="text-xs font-medium">åœ°åœ–</span>
                </a>
                <a href="#" class="flex flex-col items-center text-gray-400 dark:text-gray-500 hover:text-uspace-primary dark:hover:text-uspace-primary transition-colors">
                    <i class="fa-solid fa-tags text-xl"></i>
                    <span class="text-xs font-medium">å„ªæƒ å°ˆå€</span>
                </a>
                <a href="#" class="flex flex-col items-center text-gray-400 dark:text-gray-500 hover:text-uspace-primary dark:hover:text-uspace-primary transition-colors">
                    <i class="fa-solid fa-user text-xl"></i>
                    <span class="text-xs font-medium">å€‹äºº</span>
                </a>
            </nav>
        </footer>

    </div>

    <script>
        // (æ‚¨çš„ç¨‹å¼ç¢¼ä¸­æ²’æœ‰ themeToggle å…ƒç´ ï¼Œå› æ­¤æˆ‘ç§»é™¤äº†ç›¸é—œ JS)
        // const html = document.documentElement;
        // ... (åŸ theme toggle JS å·²ç§»é™¤) ...


        // =============================================
        // ğŸš€ åº•éƒ¨æŠ½å±œæ‰‹å‹¢äº’å‹•é‚è¼¯ (âš¡ é‡æ§‹ç‚ºå¯æ§åˆ¶ âš¡)
        // =============================================
        const drawer = document.getElementById('parking-list-drawer');
        const drawerHeader = document.getElementById('drawer-header');
        
        let isExpanded = false; 
        let isDragging = false;
        let startY = 0;
        let startTranslateY = 0; 
        
        const collapsedState = 'translateY(0)'; 
        const expandedState = 'translateY(-60vh)'; 

        function getCurrentTranslateY(element) {
            const style = window.getComputedStyle(element);
            const matrix = new DOMMatrix(style.transform);
            return matrix.m42; 
        }
        
        function setTranslateY(element, y) {
            element.style.transform = `translateY(${y}px)`;
        }

        function expandDrawer() {
            drawer.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
            drawer.style.transform = expandedState;
            isExpanded = true;
        }

        function collapseDrawer() {
            drawer.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
            drawer.style.transform = collapsedState;
            isExpanded = false;
        }
        
        function toggleDrawer() {
            if (isExpanded) {
                collapseDrawer();
            } else {
                expandDrawer();
            }
        }
        
        // âš¡ å°‡äº‹ä»¶ç›£è½å™¨æ”¹ç‚ºå‘½åå‡½æ•¸ï¼Œä»¥ä¾¿ç§»é™¤å’Œæ·»åŠ  âš¡
        function handleTouchStart(e) {
            if (!drawerHeader.contains(e.target)) return; 
            isDragging = true;
            startY = e.touches[0].clientY;
            startTranslateY = getCurrentTranslateY(drawer);
            drawer.style.transition = 'none'; 
        }

        function handleTouchMove(e) {
            if (!isDragging) return;
            
            e.preventDefault(); 

            const currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;
            let newTranslateY = startTranslateY + deltaY;
            
            const expandedYInPixels = -window.innerHeight * 0.60;
            const collapsedYInPixels = 0;
            
            if (newTranslateY < expandedYInPixels) {
                newTranslateY = expandedYInPixels - Math.pow(Math.abs(newTranslateY - expandedYInPixels), 0.7);
            }
            if (newTranslateY > collapsedYInPixels) {
                newTranslateY = collapsedYInPixels + Math.pow(newTranslateY - collapsedYInPixels, 0.7);
            }

            setTranslateY(drawer, newTranslateY);
        }

        function handleTouchEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            
            const deltaY = e.changedTouches[0].clientY - startY;
            
            if (Math.abs(deltaY) < 10 && drawerHeader.contains(e.target)) {
                toggleDrawer();
                return;
            }

            const threshold = 100; 
            
            if (isExpanded) {
                if (deltaY > threshold) {
                    collapseDrawer(); 
                } else {
                    expandDrawer(); 
                }
            } else {
                if (deltaY < -threshold) {
                    expandDrawer(); 
                } else {
                    collapseDrawer(); 
                }
            }
        }
        
        // âš¡ å‰µå»ºæ§åˆ¶å‡½æ•¸ âš¡
        function enableDrawerDrag() {
            drawer.addEventListener('touchstart', handleTouchStart, { passive: true });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }
        
        function disableDrawerDrag() {
            drawer.removeEventListener('touchstart', handleTouchStart);
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }
        
        // é è¨­å•Ÿç”¨æŠ½å±œæ‹–æ›³
        enableDrawerDrag();


        // =============================================
        // âš¡ æ–°å¢ï¼šè¤‡é¸èˆ‡å°èˆªé‚è¼¯ âš¡
        // =============================================
        
        // ç‹€æ…‹ç®¡ç†
        let isInMultiSelectMode = false;
        let selectionOrder = []; // å„²å­˜è¢«é¸ä¸­çš„å¡ç‰‡ data-id
        let pressTimer = null;

        // ç²å– DOM å…ƒç´ 
        const ctaBar = document.getElementById('multi-select-cta-bar');
        const ctaBtn = document.getElementById('start-navigation-btn');
        const cancelBtn = document.getElementById('cancel-multi-select-btn');
        const allCards = document.querySelectorAll('.parking-card');

        // é€²å…¥è¤‡é¸æ¨¡å¼
        function enterMultiSelectMode(cardElement) {
            if (isInMultiSelectMode) return;
            isInMultiSelectMode = true;
            
            // 1. åœç”¨æŠ½å±œæ‹–æ›³
            disableDrawerDrag();
            
            // 2. é¡¯ç¤ºè¤‡é¸ CTA æŒ‰éˆ•
            ctaBar.classList.remove('translate-y-full');
            
            // 3. è‡ªå‹•é¸ä¸­ç¬¬ä¸€å€‹é•·æŒ‰çš„é …ç›®
            toggleCardSelection(cardElement);
        }

        // é€€å‡ºè¤‡é¸æ¨¡å¼
        function exitMultiSelectMode() {
            if (!isInMultiSelectMode) return;
            isInMultiSelectMode = false;
            
            // 1. å•Ÿç”¨æŠ½å±œæ‹–æ›³
            enableDrawerDrag();
            
            // 2. éš±è—è¤‡é¸ CTA æŒ‰éˆ•
            ctaBar.classList.add('translate-y-full');
            
            // 3. æ¸…é™¤æ‰€æœ‰å¡ç‰‡çš„é¸ä¸­ç‹€æ…‹
            selectionOrder.forEach(id => {
                const card = document.querySelector(`.parking-card[data-id="${id}"]`);
                if(card) {
                    card.querySelector('.selection-overlay').classList.add('hidden');
                    card.querySelector('.selection-badge').classList.add('hidden');
                }
            });
            
            // 4. æ¸…ç©ºé †åºé™£åˆ—
            selectionOrder = [];
        }

        // åˆ‡æ›å¡ç‰‡é¸ä¸­ç‹€æ…‹
        function toggleCardSelection(cardElement) {
            const cardId = cardElement.dataset.id;
            const index = selectionOrder.indexOf(cardId);
            
            if (index > -1) {
                // å¦‚æœå·²é¸ä¸­ -> å–æ¶ˆé¸ä¸­
                selectionOrder.splice(index, 1);
                cardElement.querySelector('.selection-overlay').classList.add('hidden');
                cardElement.querySelector('.selection-badge').classList.add('hidden');
            } else {
                // å¦‚æœæœªé¸ä¸­ -> åŠ å…¥é¸ä¸­
                selectionOrder.push(cardId);
                cardElement.querySelector('.selection-overlay').classList.remove('hidden');
                cardElement.querySelector('.selection-badge').classList.remove('hidden');
            }
            
            // å¦‚æœé¸ä¸­çš„é …ç›®æ­¸é›¶ï¼Œè‡ªå‹•é€€å‡ºè¤‡é¸æ¨¡å¼
            if (selectionOrder.length === 0) {
                exitMultiSelectMode();
            } else {
                // å¦å‰‡ï¼Œæ›´æ–°æ‰€æœ‰ UI
                updateSelectionUI();
            }
        }

        // æ›´æ–° UI (å¾½ç« æ•¸å­—å’ŒæŒ‰éˆ•æ–‡å­—)
        function updateSelectionUI() {
            selectionOrder.forEach((id, index) => {
                const card = document.querySelector(`.parking-card[data-id="${id}"]`);
                if(card) {
                    // æ›´æ–°å¾½ç« æ•¸å­—
                    card.querySelector('.selection-badge').innerText = index + 1;
                }
            });
            
            // æ›´æ–° CTA æŒ‰éˆ•æ–‡å­—
            ctaBtn.innerText = `é–‹å§‹å°èˆª (${selectionOrder.length} ç«™)`;
        }

        // --- ç¶å®šäº‹ä»¶ ---

        // 1. ç¶å®šã€Œå–æ¶ˆã€æŒ‰éˆ•
        cancelBtn.addEventListener('click', exitMultiSelectMode);

        // 2. ç¶å®šã€Œé–‹å§‹å°èˆªã€æŒ‰éˆ•
        ctaBtn.addEventListener('click', () => {
            if (selectionOrder.length > 0) {
                const stops = selectionOrder.map((id, index) => {
                    const title = document.querySelector(`.parking-card[data-id="${id}"] h3`).title;
                    return `${index + 1}. ${title}`;
                });
                alert(`é–‹å§‹å°èˆªï¼\nåœé é»ï¼š\n${stops.join('\n')}`);
                // (æ­¤è™•æ‡‰è§¸ç™¼çœŸå¯¦çš„å°èˆª API)
                exitMultiSelectMode();
            }
        });

        // 3. ç‚ºæ‰€æœ‰å¡ç‰‡ç¶å®šã€Œé•·æŒ‰ã€å’Œã€Œé»æ“Šã€äº‹ä»¶
        allCards.forEach(card => {
             // âš¡ è³¦äºˆå¡ç‰‡ data-id (ç°¡æ˜“è³¦å€¼) âš¡
             // åœ¨çœŸå¯¦ç”¢å“ä¸­ï¼Œé€™å€‹ ID æ‡‰ç”±å¾Œç«¯æä¾›
             if (!card.dataset.id) {
                card.dataset.id = 'p' + Math.floor(Math.random() * 1000);
             }

            // è™•ç†é•·æŒ‰ (touchstart)
            card.addEventListener('touchstart', (e) => {
                // å¦‚æœæ˜¯å·²æ»¿ (ç°è‰²) å¡ç‰‡ï¼Œæˆ–æ­£åœ¨æ‹–æ›³æŠ½å±œï¼Œå‰‡ä¸è§¸ç™¼
                if (card.querySelector('.opacity-50') || isDragging) return;
                
                // é–‹å§‹è¨ˆæ™‚
                pressTimer = setTimeout(() => {
                    enterMultiSelectMode(card);
                }, 500); // 500 æ¯«ç§’ = é•·æŒ‰
            }, { passive: true });

            // è™•ç†é•·æŒ‰é‡‹æ”¾ (touchend)
            card.addEventListener('touchend', () => {
                // å¦‚æœè¨ˆæ™‚å™¨é‚„åœ¨ (è¡¨ç¤ºä¸æ»¿ 500ms)ï¼Œæ¸…é™¤å®ƒ
                clearTimeout(pressTimer);
            });
            
            // è™•ç†é•·æŒ‰æ»‘å‹• (touchmove)
            card.addEventListener('touchmove', () => {
                 // å¦‚æœæ‰‹æŒ‡æ»‘å‹•äº†ï¼Œå–æ¶ˆé•·æŒ‰
                clearTimeout(pressTimer);
            });

            // è™•ç†é»æ“Š (click)
            card.addEventListener('click', (e) => {
                // å¦‚æœæ˜¯å·²æ»¿ (ç°è‰²) å¡ç‰‡ï¼Œå‰‡ä¸è§¸ç™¼
                if (card.querySelector('.opacity-50')) return;

                if (isInMultiSelectMode) {
                    // å¦‚æœåœ¨è¤‡é¸æ¨¡å¼ä¸‹ï¼Œé»æ“Š = åˆ‡æ›é¸ä¸­
                    e.preventDefault(); // é˜»æ­¢å¯èƒ½çš„é è¨­é»æ“Šè¡Œç‚º
                    toggleCardSelection(card);
                } else {
                    // å¦å‰‡ï¼ŒåŸ·è¡Œä¸€èˆ¬çš„é»æ“Šè¡Œç‚º (ä¾‹å¦‚ï¼šè·³è½‰åˆ°åœè»Šå ´è©³æƒ…é )
                    // console.log('é»æ“Šäº†å¡ç‰‡ (éè¤‡é¸æ¨¡å¼)');
                }
            });
        });

    </script>
</body>
</html>